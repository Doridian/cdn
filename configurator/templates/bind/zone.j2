; Zone for site
$TTL    300
{%- set mainDomain = site.domains[0] %}
{%- set mainDomainStripLen = -((mainDomain | length) + 1) %}

@       3600    IN      SOA     {{ mainDomain }}. root.{{ mainDomain }}. (
                        2033053301
                        3600
                        1800
                        604800
                        3600 )

{%- if site.vanityNS %}
    {%- for record in dynConfig._find('vanityNSRecords') %}
{{ record }}
    {%- endfor %}
{%- else %}
    {%- for ns in dynConfig._find('nsrecords') %}
@       3600    IN      NS      {{ ns }}.
    {%- endfor %}
{%- endif %}

{%- for domain in site.domains %}
    {%- set domain_short = domain[:mainDomainStripLen] %}
    {%- if domain == mainDomain or domain == dynConfig._find('sitecname') %}
        {%- if domain == mainDomain %}
            {%- set domain_short = '@' %}
        {%- endif %}
        {%- for ip in dynConfig._find('siteips4') %}
{{ domain_short }} IN A {{ ip }}
        {%- endfor %}
        {%- for ip in dynConfig._find('siteips6') %}
{{ domain_short }} IN AAAA {{ ip }}
        {%- endfor %}
    {%- else %}
{{ domain_short }} IN CNAME {{ dynConfig._find('sitecname') }}.
    {%- endif %}
{%- endfor %}

{%- for record in site.records %}
{{ record }}
{%- endfor %}

{%- if site.useGoogleMX %}
@	IN	MX	5 alt2.aspmx.l.google.com.
@   IN	MX	5 alt1.aspmx.l.google.com.
@	IN	MX	1 aspmx.l.google.com.
@	IN	MX	10 aspmx3.googlemail.com.
@	IN	MX	10 aspmx2.googlemail.com.
@	IN	TXT	"v=spf1 include:_spf.google.com mx ~all"
{% endif %}
