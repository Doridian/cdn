name: CD

on:
  push:
    branches: [ master ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Run deploy
      env:
        SSH_KEY: ${{ secrets.SSH_KEY }}
      run: |
        set -euo pipefail
        echo "$SSH_KEY" > ssh-keyfile
        chmod 600 ssh-keyfile
        for loc in sea01 nyc01 van01 fra01
        do
          ssh -oStrictHostKeyChecking=no -i ssh-keyfile "deployer@$loc.pawnode.com"
        done
        rm ssh-keyfile
