name: CD

on:
  push:
    branches: [ master ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Run deploy
      env:
        SSH_KEY: ${{ secrets.SSH_KEY }}
      run: |
        set -euo pipefail
        echo "$SSH_KEY" > ssh-keyfile
        chmod 600 ssh-keyfile
        for loc in nyc1 las1 lux1
        do
            ssh -oUserKnownHostsFile=./.github/known-hosts -i ssh-keyfile "deployer@$loc.cdn.doridian.net"
        done
        rm ssh-keyfile
